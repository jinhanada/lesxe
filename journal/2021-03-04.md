# 2021-03-04


## macro

しばらくマクロの実験的な実装に取り掛かる。

expand-macroをCで書きたくなかったので、Lispでマクロシステムそのものを書けるようにしてみる。

現在は`%pre-eval`にprocが入っていたらeval前のコードをそれに食わせて評価、という方式。

ついでにhash-tableも実装してしまおう。マクロを登録するテーブルを作るために使う。

assocでもいいんだけど、hash-tableを作る動機を逃したくない。


## eval args

putc/getcの実装とともに、前々から気になっていたprimitive評価時の引数評価をまとめた。

現在の実装だとprimitive callの度に引数分リストが作られるので、GCの負荷が多分重くなる。

それを解消するにはスタックフレーム方式にしてin-placeで差し替えて行くのかな。phase2以降でやろう。